# UDP和TCP通信测试指南

本文档提供如何在Android模拟器和真机之间进行UDP和TCP通信测试的详细步骤。

## 网络配置信息

根据您提供的网络配置：
- **电脑IP地址**：192.168.31.14
- **真机IP地址**：192.168.31.26
- **模拟器内部IP地址**：10.0.2.15（Android模拟器默认）

## 准备工作

### 1. 端口转发设置（模拟器必需）

打开命令行工具，执行以下命令设置端口转发：

```shell
# 为UDP通信设置端口转发（假设使用端口8888）
adb forward tcp:8888 tcp:8888

# 为TCP通信设置额外端口转发（假设使用端口9999）
adb forward tcp:9999 tcp:9999
```

### 2. 确认网络权限

确保应用程序在AndroidManifest.xml中已添加以下权限：

```xml
<uses-permission android:name="android.permission.INTERNET"/>
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE"/>
```

## 具体测试配置方案

### 1. UDP通信测试

#### 方案1：模拟器作为接收方，真机作为发送方

**在模拟器中：**
1. 选择"UDP"通信模式
2. 侦测端口填写：`8888`
3. 其他字段留空
4. 点击"连接"按钮

**在真机中：**
1. 选择"UDP"通信模式
2. 接收方IP填写：`192.168.31.14`（电脑IP，不是模拟器IP）
3. 接收端口填写：`8888`
4. 侦测端口填写：`9999`（任意未被占用的端口）
5. 点击"连接"按钮
6. 在消息框输入内容并发送测试

#### 方案2：真机作为接收方，模拟器作为发送方

**在真机中：**
1. 选择"UDP"通信模式
2. 侦测端口填写：`8888`
3. 其他字段留空
4. 点击"连接"按钮

**在模拟器中：**
1. 选择"UDP"通信模式
2. 接收方IP填写：`192.168.31.26`（真机IP）
3. 接收端口填写：`8888`
4. 侦测端口填写：`9999`
5. 点击"连接"按钮
6. 在消息框输入内容并发送测试

### 2. TCP通信测试

#### 方案1：模拟器作为TCP服务器，真机作为客户端

**在模拟器中：**
1. 选择"TCP服务器"模式
2. 服务器端口填写：`9999`
3. 点击"连接"按钮启动服务器

**在真机中：**
1. 选择"TCP"（客户端）模式
2. 接收方IP填写：`192.168.31.14`（电脑IP）
3. 接收端口填写：`9999`
4. 点击"连接"按钮
5. 连接成功后发送消息进行测试

#### 方案2：真机作为TCP服务器，模拟器作为客户端

**在真机中：**
1. 选择"TCP服务器"模式
2. 服务器端口填写：`9999`
3. 点击"连接"按钮启动服务器

**在模拟器中：**
1. 选择"TCP"（客户端）模式
2. 接收方IP填写：`192.168.31.26`（真机IP）
3. 接收端口填写：`9999`
4. 点击"连接"按钮
5. 连接成功后发送消息进行测试

## 可能出现的问题及解决方案

### 连接失败时的检查项：

1. **端口转发错误**
   - 在命令行重新执行adb命令：`adb forward tcp:8888 tcp:8888`
   - 检查命令是否返回成功

2. **防火墙阻止**
   - 在Windows Defender防火墙设置中临时关闭防火墙
   - 或添加端口例外：控制面板 → Windows Defender防火墙 → 允许应用或功能通过防火墙 → 添加端口

3. **IP地址变化**
   - 检查电脑IP是否仍然是`192.168.31.14`
   - 检查真机IP是否仍然是`192.168.31.26`

4. **模拟器重启**
   - 模拟器重启后需重新执行端口转发命令

### 建议的通信测试步骤：

1. 首先测试 UDP 模式（模拟器接收，真机发送）
2. 然后测试 UDP 模式（真机接收，模拟器发送）
3. 接着测试 TCP 服务器-客户端模式（两种组合）
4. 测试不同大小的消息传输

## 其他说明

- 数据传输可能会有延迟，尤其是在网络较拥挤的情况下
- 确保测试过程中手机不进入休眠状态，以免网络连接断开
- 如遇问题，可检查应用日志输出，查看具体错误信息